"use strict";(()=>{var t={};t.id=744,t.ids=[744],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3848:(t,e,r)=>{r.r(e),r.d(e,{originalPathname:()=>f,patchFetch:()=>m,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>d});var a={};r.r(a),r.d(a,{POST:()=>u});var o=r(3278),s=r(5002),n=r(4877),i=r(1309);class c{constructor(t,e="AstraCS:HBhBtTOlConToxvZKeHximyo:3976df6dec45321b583ad1d6633c198e4f10ab54d6a56816767145cfbdb5fc37"){this.baseURL=t,this.applicationToken=e}async post(t,e,r={}){r.Authorization=`Bearer ${this.applicationToken}`,r["Content-Type"]="application/json";let a=`${this.baseURL}${t}`;try{let t=await fetch(a,{method:"POST",headers:r,body:JSON.stringify(e)}),o=await t.json();if(!t.ok)throw Error(`${t.status} ${t.statusText} - ${JSON.stringify(o)}`);return o}catch(t){throw console.error("Request Error:",t),t}}async initiateSession(t,e,r,a="chat",o="chat",s=!1,n={}){let i=`/lf/${e}/api/v1/run/${t}?stream=${s}`;return this.post(i,{input_value:r,input_type:a,output_type:o,tweaks:n})}handleStream(t,e,r,a){let o=new EventSource(t);return o.onmessage=t=>{e(JSON.parse(t.data))},o.onerror=t=>{console.error("Stream Error:",t),a(t),o.close()},o.addEventListener("close",()=>{r("Stream closed"),o.close()}),o}async runFlow(t,e,r,a="chat",o="chat",s={},n=!1,i,c,u){try{let p=await this.initiateSession(t,e,r,a,o,n,s);if(n&&p?.outputs?.[0]?.outputs?.[0]?.artifacts?.stream_url&&i&&c&&u){let t=p.outputs[0].outputs[0].artifacts.stream_url;console.log(`Streaming from: ${t}`),this.handleStream(t,i,c,u)}return p}catch(t){throw console.error("Error running flow:",t),u&&u("Error initiating session"),t}}}async function u(t){try{let{messages:e}=await t.json(),r=e[e.length-1],a="7bedef0d-c20f-4849-99c8-08093bb345d2",o="d4db2943-5547-4f36-8d55-4cb64223be8c",s="AstraCS:HBhBtTOlConToxvZKeHximyo:3976df6dec45321b583ad1d6633c198e4f10ab54d6a56816767145cfbdb5fc37";if(!a||!o||!s)return i.NextResponse.json({error:"Missing environment variables"},{status:500});let n=new c("https://api.langflow.astra.datastax.com",s),u=await n.runFlow(a,o,r.content,"chat","chat",{"AstraDB-m8WFT":{},"ParseData-F4OL7":{},"ParseData-2pDOZ":{},"ParseData-0nnXV":{},"Prompt-fvBvh":{},"GoogleGenerativeAIModel-ilsuF":{},"ChatOutput-JtbDE":{}},!1),p=u?.outputs?.[0]?.outputs?.[0]?.results?.message?.text;if(!p||"string"!=typeof p)throw console.error("Invalid response structure:",u),Error("Invalid response format from Langflow");return i.NextResponse.json({id:crypto.randomUUID(),role:"assistant",content:p.trim()})}catch(t){return console.error("Chat API Error:",t),i.NextResponse.json({error:t instanceof Error?t.message:"An unknown error occurred"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"D:\\social-media-analysis\\app\\api\\chat\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:h}=p,f="/api/chat/route";function m(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:d})}}};var e=require("../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),a=e.X(0,[787,833],()=>r(3848));module.exports=a})();